let silverPrices=[];const initialDisplayCount=15;let currentDisplayCount=initialDisplayCount;function getTodayDateString(){var e=new Date;return e.getFullYear()+`-${String(e.getMonth()+1).padStart(2,"0")}-`+String(e.getDate()).padStart(2,"0")}function getYesterdayDateString(){var e=new Date,t=(e.setDate(e.getDate()-1),e.getFullYear());return t+`-${String(e.getMonth()+1).padStart(2,"0")}-`+String(e.getDate()).padStart(2,"0")}async function fetchSilverPrices(t){t=`https://gold-price-api-c095eaf86dce.herokuapp.com/api/silver/date/${t}?cache_buster=`+Date.now();try{var r=await fetch(t,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!r.ok)throw new Error("HTTP error! status: "+r.status);var a=await r.json();if(!a||"object"!=typeof a)throw new Error("Invalid response: not an object");let e;if(Array.isArray(a.silver_rates))e=a.silver_rates;else{if(!a.data||!Array.isArray(a.data.silver_rates))throw new Error("Invalid data structure: silver_rates is missing or not an array");e=a.data.silver_rates}return e}catch(e){return displayError("Failed to fetch or parse prices: "+e.message),null}}async function fetchHistoricalSilverPrices(e=20){e="https://gold-price-api-c095eaf86dce.herokuapp.com/api/silver/history/"+e;try{var t=await fetch(e);if(t.ok)return await t.json();throw new Error("HTTP error! status: "+t.status)}catch(e){return console.error("Error fetching historical silver prices:",e),null}}async function fetchAndComparePrices(){showLoadingSpinner();var e=getTodayDateString(),t=getYesterdayDateString();try{var[r,a,n]=await Promise.all([fetchSilverPrices(e),fetchSilverPrices(t),fetchHistoricalSilverPrices(20)]);if(!(r&&a&&n))throw new Error("Failed to fetch silver prices for today or yesterday");silverPrices=r,clearPriceCards(),createMumbaiPriceCards(r,a),displayMumbaiPriceComparison(r,a),populateCityDropdowns(),populatePriceTable(),populateSilverSidebar(),createHistoricalSilverPriceChart(n)}catch(e){displayError("Failed to fetch or compare prices: "+e.message)}finally{hideLoadingSpinner()}}function createHistoricalSilverPriceChart(e){var t=document.getElementById("historicalSilverPriceChart").getContext("2d"),r=e.map(e=>new Date(e.timestamp).toLocaleDateString()),e=e.map(e=>{e=e.data.silver_rates.find(e=>"Mumbai"===e.city);return e?parseIndianPrice(e["10_gram"])/10:null}).filter(e=>null!==e),r=r.slice(0,e.length);new Chart(t,{type:"line",data:{labels:r,datasets:[{label:"Silver Price in India (per gram)",data:e,borderColor:"silver",backgroundColor:"rgba(192, 192, 192, 0.1)",borderWidth:2,pointRadius:3,pointHoverRadius:5,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Date"}},y:{title:{display:!0,text:"Price (₹)"},beginAtZero:!1}},plugins:{legend:{display:!0,position:"top"},tooltip:{mode:"index",intersect:!1}}}})}function parseIndianPrice(e){e=e.replace(/[^\d.]/g,"");return parseFloat(e)}function createMumbaiPriceCards(e,t){if(document.getElementById("priceCards")){const a=e.find(e=>"Mumbai"===e.city),n=t.find(e=>"Mumbai"===e.city);a&&n?[{label:"1 Gram",value:1},{label:"10 Gram",value:10},{label:"1 Kg",value:1e3}].forEach(e=>{var t=parseIndianPrice(a["10_gram"])/10*e.value,r=parseIndianPrice(n["10_gram"])/10*e.value;createPriceCard(e.label,t,t-r)}):console.error("Mumbai prices not found")}else console.error("priceCardsContainer is not defined")}function createPriceCard(e,t,r){var a=document.getElementById("priceCards"),n=document.createElement("div"),i=(n.className="bg-white rounded-xl shadow-2xl p-8 text-center price-card mb-4 w-full md:w-1/3",document.createElement("h3")),e=(i.className="text-2xl font-bold text-indigo-800 mb-4",i.textContent=e+" Gram"+(1<e?"s":""),document.createElement("p")),t=(e.className="text-xl text-gray-700",e.textContent="₹ "+t.toFixed(2),document.createElement("p")),c=(t.className="text-lg "+(0<r?"text-green-600":"text-red-600"),0<r?"↑":"↓");t.textContent=c+" "+Math.abs(r).toFixed(2),n.appendChild(i),n.appendChild(e),n.appendChild(t),a.appendChild(n)}function populateSilverSidebar(){const i=document.getElementById("topCitiesList");i&&(i.innerHTML="",["Mumbai","Delhi","Bangalore","Chennai","Kolkata","Hyderabad","Kerala","Pune"].forEach(t=>{const r=silverPrices.find(e=>e.city===t);if(r){var e=document.createElement("li"),a=(e.className="mb-4",document.createElement("h3"));a.className="text-lg font-semibold text-indigo-800 mb-2",a.textContent="Silver Price in "+t,e.appendChild(a);const n=document.createElement("ul");n.className="list-none pl-0",["10_gram","100_gram","1_kg"].forEach(e=>{var t=document.createElement("li");t.className="text-sm text-gray-600",t.textContent=e.replace("_"," ")+": "+r[e],n.appendChild(t)}),e.appendChild(n),i.appendChild(e)}}))}function displayCitySilverPrices(t){var e,r,a,n,i,c=silverPrices.find(e=>e.city===t);c?(e=document.getElementById("citySilverPrices"),r=document.getElementById("selectedCityName"),a=document.getElementById("price10Gram"),n=document.getElementById("price100Gram"),i=document.getElementById("price1Kg"),r.textContent="Silver Price in "+t,a.textContent="10g: "+c["10_gram"],n.textContent="100g: "+c["100_gram"],i.textContent="1kg: "+c["1_kg"],e.classList.remove("hidden")):console.error("No data found for city: "+t)}function displayMumbaiPriceComparison(e,t){var r=document.getElementById("priceComparison");r.innerHTML="";const i=e.find(e=>"Mumbai"===e.city),c=t.find(e=>"Mumbai"===e.city);if(i&&c){e=document.createElement("table"),t=(e.className="w-full bg-white shadow-lg rounded-lg overflow-hidden",document.createElement("thead"));t.innerHTML=`
        <tr class="bg-indigo-800 text-white">
            <th class="py-3 px-4 text-left">Weight</th>
            <th class="py-3 px-4 text-left">Today's Price</th>
            <th class="py-3 px-4 text-left">Yesterday's Price</th>
            <th class="py-3 px-4 text-left">Change</th>
        </tr>
    `;const l=document.createElement("tbody");["10_gram","100_gram","1_kg"].forEach(e=>{var t=document.createElement("tr"),r=parseIndianPrice(i[e]),a=parseIndianPrice(c[e]),n=r-a;t.innerHTML=`
            <td class="py-3 px-4 border-b">${e.replace("_"," ")}</td>
            <td class="py-3 px-4 border-b">₹ ${r.toFixed(2)}</td>
            <td class="py-3 px-4 border-b">₹ ${a.toFixed(2)}</td>
            <td class="py-3 px-4 border-b ${0<n?"text-green-600":"text-red-600"}">
                ${0<n?"↑":"↓"} ${Math.abs(n).toFixed(2)}
            </td>
        `,l.appendChild(t)}),e.appendChild(t),e.appendChild(l),r.appendChild(e)}else console.error("Mumbai prices not found")}function populatePriceTable(){const c=document.querySelector("#priceTable tbody");c.innerHTML="",silverPrices&&0!==silverPrices.length?(silverPrices.slice(0,currentDisplayCount).forEach(e=>{var t=document.createElement("tr"),r=document.createElement("td"),a=(r.className="p-4 border-b",r.textContent=e.city,document.createElement("td")),n=(a.className="p-4 border-b",a.textContent=e["10_gram"],document.createElement("td")),i=(n.className="p-4 border-b",n.textContent=e["100_gram"],document.createElement("td"));i.className="p-4 border-b",i.textContent=e["1_kg"],t.appendChild(r),t.appendChild(a),t.appendChild(n),t.appendChild(i),c.appendChild(t)}),updateLoadMoreButton()):(console.error("No silver prices available to display"),displayError("No silver prices available to display"))}function updateLoadMoreButton(){var e=document.getElementById("loadMoreButton");currentDisplayCount>=silverPrices.length?e.style.display="none":e.style.display="block"}function clearPriceCards(){var e=document.getElementById("priceCards");e&&(e.innerHTML="")}function parseIndianPrice(e){e=e.replace(/[^\d.]/g,"");return parseFloat(e)}function populateCityDropdowns(){[document.getElementById("citySelectCustom"),document.getElementById("citySelectPrices")].forEach(r=>{r.innerHTML='<option value="">Select City</option>',silverPrices.forEach(e=>{var t=document.createElement("option");t.value=e.city,t.textContent=e.city,r.appendChild(t)})})}function updateCityPriceCard(e){var t=document.getElementById("cityPriceCardSection");t&&(t.querySelector(".price-999").textContent="999: "+e["10_gram"])}function calculateCustomPrice(){const t=document.getElementById("citySelectCustom").value;var e,r=parseFloat(document.getElementById("gramInput").value);!t||isNaN(r)?alert("Please fill in all fields correctly."):(e=silverPrices.find(e=>e.city===t))?(e=parseIndianPrice(e["10_gram"])/10*r,document.getElementById("calculationResult").textContent="Total Price: ₹ "+e.toFixed(2)):alert("City data not found.")}function updateCityPrices(t){var e=silverPrices.find(e=>e.city===t);e&&updateCityPriceCard(e)}function showLoadingSpinner(){document.getElementById("loadingSpinner").classList.remove("hidden")}function hideLoadingSpinner(){document.getElementById("loadingSpinner").classList.add("hidden")}function displayError(e){var t=document.getElementById("errorMessage");t.textContent=e,t.classList.remove("hidden")}function updateDateTime(){var e=(new Date).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"});document.getElementById("lastUpdated").innerHTML=`<span style="font-size: 1.2em; font-weight: bold;">${e}</span>`}document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelector('[role="main"]'),t=document.createElement("div"),e=(t.className="mt-8",t.innerHTML=`<h2 class="text-2xl font-bold text-indigo-800 mb-4">Historical Silver Prices (Last 10 Days)</h2>
    <div class="bg-white rounded-xl shadow-2xl p-4">
      <canvas id="historicalSilverPriceChart" style="height: 300px;"></canvas>
    </div>`,e.appendChild(t),document.getElementById("refreshButton")),t=(e&&e.addEventListener("click",fetchAndComparePrices),document.getElementById("calculateButton")),e=(t&&t.addEventListener("click",calculateCustomPrice),document.getElementById("loadMoreButton")),t=(e&&e.addEventListener("click",()=>{currentDisplayCount+=initialDisplayCount,populatePriceTable()}),document.getElementById("citySelectCustom")),e=(t&&t.addEventListener("change",e=>{var e=e.target.value,t=document.getElementById("citySelectPrices");t&&(t.value=e),updateCityPrices(e)}),document.getElementById("citySelectPrices"));e&&e.addEventListener("change",e=>{var e=e.target.value,t=document.getElementById("citySelectCustom");t&&(t.value=e),updateCityPrices(e)}),fetchAndComparePrices(),updateDateTime(),setInterval(updateDateTime,1e3),populateSilverSidebar()});
