let goldPrices=[];const initialDisplayCount=20;let currentDisplayCount=20;function getTodayDateString(){let e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${a}`}function getYesterdayDateString(){let e=new Date;e.setDate(e.getDate()-1);let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${a}`}async function fetchGoldPrices(e){try{let t=`https://raw.githubusercontent.com/Technoresult/GoldPriceCalculator/main/Folder/G_${e}.json`;console.log("Fetching URL:",t);let r=await fetch(t),a=await r.json();return console.log("Parsed data:",a),a.gold_prices}catch(l){return console.error("Error fetching or parsing prices:",l),displayError("Failed to fetch or parse prices: "+l.message),null}}async function fetchAndComparePrices(){showLoadingSpinner();let e=getTodayDateString(),t=getYesterdayDateString();try{let[r,a]=await Promise.all([fetchGoldPrices(e),fetchGoldPrices(t)]);r&&a&&(goldPrices=r,clearPriceCards(),createAveragePriceCards(r,a),displayAveragePriceComparison(r,a),populateCityDropdowns(),populateGoldPricesTable(),populateGoldSidebar())}catch(l){console.error("Error fetching or comparing prices:",l),displayError("Failed to fetch or compare prices: "+l.message)}finally{hideLoadingSpinner()}}function calculateAveragePrice(e,t){let r=e.reduce((e,r)=>e+parseIndianPrice(r[`${t} Today`]),0);return r/e.length}function createAveragePriceCards(e,t){let r=document.getElementById("priceCards");if(!r){console.error("priceCardsContainer is not defined");return}["24K","22K","18K"].forEach(r=>{let a=calculateAveragePrice(e,r),l=calculateAveragePrice(t,r);createPriceCard(r,a,a-l)})}function createPriceCard(e,t,r){let a=document.getElementById("priceCards"),l=document.createElement("div");l.className="bg-white rounded-xl shadow-2xl p-8 text-center price-card mb-4 w-full md:w-1/3";let n=document.createElement("h3");n.className="text-2xl font-bold text-indigo-800 mb-4",n.textContent=`${e} Gold`;let i=document.createElement("p");i.className="text-xl text-gray-700",i.textContent=`₹ ${t.toFixed(2)}`;let d=document.createElement("p");d.className=`text-lg ${r>0?"text-green-600":"text-red-600"}`,d.textContent=`${r>0?"↑":"↓"} ${Math.abs(r).toFixed(2)}`,l.appendChild(n),l.appendChild(i),l.appendChild(d),a.appendChild(l)}function populateGoldSidebar(){let e=document.getElementById("topGoldCitiesList");e&&(e.innerHTML="",["Mumbai","Delhi","Bangalore","Chennai","Kolkata","Hyderabad","Kerala","Pune"].forEach(t=>{let r=goldPrices.find(e=>e.City===t);if(r){let a=document.createElement("li");a.className="mb-4";let l=document.createElement("h3");l.className="sidebar-city-name",l.textContent=`Gold Price in ${t}`,a.appendChild(l);let n=document.createElement("ul");n.className="sidebar-price-list",["24K","22K","18K"].forEach(e=>{let t=document.createElement("li");t.className="sidebar-price-item",t.textContent=`${e}: ${r[`${e} Today`]}`,n.appendChild(t)}),a.appendChild(n),e.appendChild(a)}}))}function displayCityGoldPrices(e){let t=goldPrices.find(t=>t.City===e);if(!t){console.error(`No data found for city: ${e}`);return}let r=document.getElementById("cityGoldPrices"),a=document.getElementById("selectedCityName"),l=document.getElementById("price24K"),n=document.getElementById("price22K"),i=document.getElementById("price18K");a.textContent=`Gold Price in ${e}`,l.textContent=`24K: ${t["24K Today"]}`,n.textContent=`22K: ${t["22K Today"]}`,i.textContent=`18K: ${t["18K Today"]}`,r.classList.remove("hidden")}function displayAveragePriceComparison(e,t){let r=document.getElementById("priceComparison");if(!r){console.error("priceComparison element not found");return}r.innerHTML="";let a=document.createElement("table");a.className="w-full bg-white shadow-lg rounded-lg overflow-hidden";let l=document.createElement("thead");l.innerHTML=`
        <tr class="bg-indigo-800 text-white">
            <th class="py-3 px-4 text-left">Carat</th>
            <th class="py-3 px-4 text-left">Today's Price</th>
            <th class="py-3 px-4 text-left">Yesterday's Price</th>
            <th class="py-3 px-4 text-left">Change</th>
        </tr>
    `;let n=document.createElement("tbody");["24K","22K","18K"].forEach(r=>{let a=calculateAveragePrice(e,r),l=calculateAveragePrice(t,r),i=a-l,d=document.createElement("tr");d.innerHTML=`
            <td class="py-3 px-4 border-b">${r}</td>
            <td class="py-3 px-4 border-b">₹ ${a.toFixed(2)}</td>
            <td class="py-3 px-4 border-b">₹ ${l.toFixed(2)}</td>
            <td class="py-3 px-4 border-b ${i>0?"text-green-600":"text-red-600"}">
                ${i>0?"↑":"↓"} ${Math.abs(i).toFixed(2)}
            </td>
        `,n.appendChild(d)}),a.appendChild(l),a.appendChild(n),r.appendChild(a)}function populateCityDropdowns(){let e=document.getElementById("citySelectCustom"),t=document.getElementById("citySelectPrices");[e,t].forEach(e=>{e&&(e.innerHTML='<option value="">Select City</option>',goldPrices.forEach(t=>{let r=document.createElement("option");r.value=t.City,r.textContent=t.City,e.appendChild(r)}))})}function updateCityPriceCard(e){let t=document.getElementById("cityPriceCard");t&&["24K","22K","18K"].forEach(r=>{let a=t.querySelector(`.price-${r}`);a&&(a.textContent=`${r}: ${e[`${r} Today`]}`)})}function calculateCustomPrice(){let e=document.getElementById("citySelectCustom")?.value,t=document.getElementById("caratSelect")?.value,r=parseFloat(document.getElementById("gramInput")?.value);if(!e||!t||isNaN(r)){alert("Please fill in all fields correctly.");return}let a=goldPrices.find(t=>t.City===e);if(!a){alert("City data not found.");return}let l=a[`${t} Today`];if(!l){alert(`Price data for ${t} not available for ${e}.`);return}let n=parseIndianPrice(l),i=document.getElementById("calculationResult");i&&(i.textContent=`Total Price: ₹ ${(n*r).toFixed(2)}`)}function populateGoldPricesTable(){let e=document.querySelector("#goldPricesTable tbody");if(!e){console.error("Gold prices table body not found");return}if(e.innerHTML="",!goldPrices||0===goldPrices.length){console.error("No gold prices available to display"),displayError("No gold prices available to display");return}let t=goldPrices.slice(0,currentDisplayCount);t.forEach(t=>{let r=document.createElement("tr");["City","24K Today","22K Today","18K Today"].forEach(e=>{let a=document.createElement("td");a.className="py-3 px-4 border-b",a.textContent=t[e],r.appendChild(a)}),e.appendChild(r)}),updateViewMoreButton()}function updateViewMoreButton(){let e=document.getElementById("viewMoreBtn");e&&(e.style.display=currentDisplayCount>=goldPrices.length?"none":"inline-block")}function parseIndianPrice(e){return parseFloat(e.replace(/[^\d.]/g,""))}function showLoadingSpinner(){let e=document.getElementById("loadingSpinner");e&&e.classList.remove("hidden")}function hideLoadingSpinner(){let e=document.getElementById("loadingSpinner");e&&e.classList.add("hidden")}function displayError(e){let t=document.getElementById("errorMessage");t&&(t.textContent=e,t.classList.remove("hidden"))}function updateDateTime(){let e=new Date,t=e.toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),r=document.getElementById("lastUpdated");r&&(r.innerHTML=`<span style="font-size: 1.2em; font-weight: bold;">${t}</span>`)}function clearPriceCards(){let e=document.getElementById("priceCards");e&&(e.innerHTML="")}function updateCityPrices(e){let t=goldPrices.find(t=>t.City===e);t&&updateCityPriceCard(t)}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("refreshButton");e&&e.addEventListener("click",fetchAndComparePrices);let t=document.getElementById("calculateButton");t&&t.addEventListener("click",calculateCustomPrice);let r=document.getElementById("viewMoreBtn");r&&r.addEventListener("click",()=>{currentDisplayCount+=20,populateGoldPricesTable()});let a=document.getElementById("citySelectCustom");a&&a.addEventListener("change",e=>{let t=e.target.value,r=document.getElementById("citySelectPrices");r&&(r.value=t),updateCityPrices(t)});let l=document.getElementById("citySelectPrices");l&&l.addEventListener("change",e=>{let t=e.target.value,r=document.getElementById("citySelectCustom");r&&(r.value=t),updateCityPrices(t)}),fetchAndComparePrices(),updateDateTime(),setInterval(updateDateTime,1e3),populateGoldSidebar()});
