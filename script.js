let goldPrices=[];const initialDisplayCount=15;let currentDisplayCount=initialDisplayCount;function getTodayDateString(){var e=new Date;return e.getFullYear()+`-${String(e.getMonth()+1).padStart(2,"0")}-`+String(e.getDate()).padStart(2,"0")}function getYesterdayDateString(){var e=new Date,t=(e.setDate(e.getDate()-1),e.getFullYear());return t+`-${String(e.getMonth()+1).padStart(2,"0")}-`+String(e.getDate()).padStart(2,"0")}async function fetchGoldPrices(t){t=`https://gold-price-api-c095eaf86dce.herokuapp.com/api/gold/date/${t}?cache_buster=`+Date.now();try{var a=await fetch(t,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(!a.ok)throw new Error("HTTP error! status: "+a.status);var r=await a.json();if(!r||"object"!=typeof r)throw new Error("Invalid response: not an object");let e;if(Array.isArray(r.gold_prices))e=r.gold_prices;else{if(!r.data||!Array.isArray(r.data.gold_prices))throw new Error("Invalid data structure: gold_prices is missing or not an array");e=r.data.gold_prices}return e}catch(e){return displayError("Failed to fetch or parse prices: "+e.message),null}}async function fetchHistoricalPrices(e=10){e="https://gold-price-api-c095eaf86dce.herokuapp.com/api/gold/history/"+e;try{var t=await fetch(e);if(t.ok)return await t.json();throw new Error("HTTP error! status: "+t.status)}catch(e){return console.error("Error fetching historical prices:",e),null}}async function fetchAndComparePrices(){showLoadingSpinner();var e=getTodayDateString(),t=getYesterdayDateString();try{var[a,r,n]=await Promise.all([fetchGoldPrices(e),fetchGoldPrices(t),fetchHistoricalPrices(20)]);if(!(a&&r&&n))throw new Error("Failed to fetch gold prices for today, yesterday, or historical data");goldPrices=a,clearPriceCards(),createMumbaiPriceCards(a,r),displayMumbaiPriceComparison(a,r),populateCityDropdowns(),populateGoldPricesTable(),populateGoldSidebar(),createHistoricalPriceChart(n)}catch(e){displayError("Failed to fetch or compare prices: "+e.message)}finally{hideLoadingSpinner()}}function createMumbaiPriceCards(e,t){if(document.getElementById("priceCards")){const a=e.find(e=>"Mumbai"===e.City),r=t.find(e=>"Mumbai"===e.City);a&&r?["24K","22K","18K"].forEach(e=>{var t=parseIndianPrice(a[e+" Today"]);createPriceCard(e,t,t-parseIndianPrice(r[e+" Today"]))}):console.error("Mumbai prices not found")}else console.error("priceCardsContainer is not defined")}function parseIndianPrice(e){return parseFloat(e.replace("₹","").replace(",","").trim())}function createHistoricalPriceChart(e){var t=document.getElementById("historicalPriceChart").getContext("2d"),a=e.map(e=>new Date(e.timestamp).toLocaleDateString());const r=e.map(e=>{e=e.data.gold_prices.find(e=>"Mumbai"===e.City);return e?parseIndianPrice(e["24K Today"]):null});var n=e.map(e=>{e=e.data.gold_prices.find(e=>"Mumbai"===e.City);return e?parseIndianPrice(e["22K Today"]):null}),e=e.map(e=>{e=e.data.gold_prices.find(e=>"Mumbai"===e.City);return e?parseIndianPrice(e["18K Today"]):null}),a=a.filter((e,t)=>null!==r[t]),i=r.filter(e=>null!==e),n=n.filter(e=>null!==e),e=e.filter(e=>null!==e);new Chart(t,{type:"line",data:{labels:a,datasets:[{label:"24K Gold Price",data:i,borderColor:"gold",backgroundColor:"rgba(255, 215, 0, 0.1)",borderWidth:2,pointRadius:3,pointHoverRadius:5,fill:!0},{label:"22K Gold Price",data:n,borderColor:"silver",backgroundColor:"rgba(192, 192, 192, 0.1)",borderWidth:2,pointRadius:3,pointHoverRadius:5,fill:!0},{label:"18K Gold Price",data:e,borderColor:"bronze",backgroundColor:"rgba(139, 69, 19, 0.1)",borderWidth:2,pointRadius:3,pointHoverRadius:5,fill:!0}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{title:{display:!0,text:"Date"}},y:{title:{display:!0,text:"Price (₹)"},beginAtZero:!1}},plugins:{legend:{display:!0,position:"top"},tooltip:{mode:"index",intersect:!1}}}})}function createPriceCard(e,t,a){var r=document.getElementById("priceCards"),n=document.createElement("div"),i=(n.className="bg-white rounded-xl shadow-2xl p-8 text-center price-card mb-4 w-full md:w-1/3",document.createElement("h3")),e=(i.className="text-2xl font-bold text-indigo-800 mb-4",i.textContent=e+" Gold",document.createElement("p")),t=(e.className="text-xl text-gray-700",e.textContent="₹ "+t.toFixed(2),document.createElement("p")),o=(t.className="text-lg "+(0<a?"text-green-600":"text-red-600"),0<a?"↑":"↓");t.textContent=o+" "+Math.abs(a).toFixed(2),n.appendChild(i),n.appendChild(e),n.appendChild(t),r.appendChild(n)}function populateGoldSidebar(){const i=document.getElementById("topGoldCitiesList");i&&(i.innerHTML="",["Mumbai","Delhi","Bangalore","Chennai","Kolkata","Hyderabad","Kerala","Pune"].forEach(t=>{const a=goldPrices.find(e=>e.City===t);if(a){var e=document.createElement("li"),r=(e.className="mb-4",document.createElement("h3"));r.className="sidebar-city-name",r.textContent="Gold Price in "+t,e.appendChild(r);const n=document.createElement("ul");n.className="sidebar-price-list",["24K","22K","18K"].forEach(e=>{var t=document.createElement("li");t.className="sidebar-price-item",t.textContent=e+": "+a[e+" Today"],n.appendChild(t)}),e.appendChild(n),i.appendChild(e)}}))}function displayCityGoldPrices(t){var e,a,r,n,i,o=goldPrices.find(e=>e.City===t);o?(e=document.getElementById("cityGoldPrices"),a=document.getElementById("selectedCityName"),r=document.getElementById("price24K"),n=document.getElementById("price22K"),i=document.getElementById("price18K"),a.textContent="Gold Price in "+t,r.textContent="24K: "+o["24K Today"],n.textContent="22K: "+o["22K Today"],i.textContent="18K: "+o["18K Today"],e.classList.remove("hidden")):console.error("No data found for city: "+t)}function displayMumbaiPriceComparison(e,t){var a=document.getElementById("priceComparison");if(a){a.innerHTML="";const i=e.find(e=>"Mumbai"===e.City),o=t.find(e=>"Mumbai"===e.City);if(i&&o){e=document.createElement("table"),t=(e.className="w-full bg-white shadow-lg rounded-lg overflow-hidden",document.createElement("thead"));t.innerHTML=`
        <tr class="bg-indigo-800 text-white">
            <th class="py-3 px-4 text-left">Carat</th>
            <th class="py-3 px-4 text-left">Today's Price</th>
            <th class="py-3 px-4 text-left">Yesterday's Price</th>
            <th class="py-3 px-4 text-left">Change</th>
        </tr>
    `;const d=document.createElement("tbody");["24K","22K","18K"].forEach(e=>{var t=parseIndianPrice(i[e+" Today"]),a=parseIndianPrice(o[e+" Today"]),r=t-a,n=document.createElement("tr");n.innerHTML=`
            <td class="py-3 px-4 border-b">${e}</td>
            <td class="py-3 px-4 border-b">₹ ${t.toFixed(2)}</td>
            <td class="py-3 px-4 border-b">₹ ${a.toFixed(2)}</td>
            <td class="py-3 px-4 border-b ${0<r?"text-green-600":"text-red-600"}">
                ${0<r?"↑":"↓"} ${Math.abs(r).toFixed(2)}
            </td>
        `,d.appendChild(n)}),e.appendChild(t),e.appendChild(d),a.appendChild(e)}else console.error("Mumbai prices not found")}else console.error("priceComparison element not found")}function populateCityDropdowns(){[document.getElementById("citySelectCustom"),document.getElementById("citySelectPrices")].forEach(a=>{a&&(a.innerHTML='<option value="">Select City</option>',goldPrices.forEach(e=>{var t=document.createElement("option");t.value=e.City,t.textContent=e.City,a.appendChild(t)}))})}function updateCityPriceCard(a){const r=document.getElementById("cityPriceCard");r&&["24K","22K","18K"].forEach(e=>{var t=r.querySelector(".price-"+e);t&&(t.textContent=e+": "+a[e+" Today"])})}function calculateCustomPrice(){const t=document.getElementById("citySelectCustom")?.value;var e,a=document.getElementById("caratSelect")?.value,r=parseFloat(document.getElementById("gramInput")?.value);t&&a&&!isNaN(r)?(e=goldPrices.find(e=>e.City===t))?(e=e[a+" Today"])?(e=parseIndianPrice(e)*r,(r=document.getElementById("calculationResult"))&&(r.textContent="Total Price: ₹ "+e.toFixed(2))):alert(`Price data for ${a} not available for ${t}.`):alert("City data not found."):alert("Please fill in all fields correctly.")}function populateGoldPricesTable(){const e=document.querySelector("#goldPricesTable tbody");e?(e.innerHTML="",goldPrices&&0!==goldPrices.length?(goldPrices.slice(0,currentDisplayCount).forEach(a=>{const r=document.createElement("tr");["City","24K Today","22K Today","18K Today"].forEach(e=>{var t=document.createElement("td");t.className="py-3 px-4 border-b",t.textContent=a[e],r.appendChild(t)}),e.appendChild(r)}),updateViewMoreButton()):(console.error("No gold prices available to display"),displayError("No gold prices available to display"))):console.error("Gold prices table body not found")}function updateViewMoreButton(){var e=document.getElementById("viewMoreBtn");e&&(e.style.display=currentDisplayCount>=goldPrices.length?"none":"inline-block")}function parseIndianPrice(e){return parseFloat(e.replace(/[^\d.]/g,""))}function showLoadingSpinner(){var e=document.getElementById("loadingSpinner");e&&e.classList.remove("hidden")}function hideLoadingSpinner(){var e=document.getElementById("loadingSpinner");e&&e.classList.add("hidden")}function displayError(e){var t=document.getElementById("errorMessage");t&&(t.textContent=e,t.classList.remove("hidden"))}function updateDateTime(){var e=(new Date).toLocaleDateString("en-IN",{year:"numeric",month:"long",day:"numeric"}),t=document.getElementById("lastUpdated");t&&(t.innerHTML=`<span style="font-size: 1.2em; font-weight: bold;">${e}</span>`)}function clearPriceCards(){var e=document.getElementById("priceCards");e&&(e.innerHTML="")}function updateCityPrices(t){var e=goldPrices.find(e=>e.City===t);e&&updateCityPriceCard(e)}document.addEventListener("DOMContentLoaded",()=>{var e=document.querySelector('[role="main"]'),t=document.createElement("div"),e=(t.className="mt-8",t.innerHTML=`<h2 class="text-2xl font-bold text-indigo-800 mb-4">Historical Gold Prices (Last 10 Days)</h2>
    <div class="bg-white rounded-xl shadow-2xl p-4">
      <canvas id="historicalPriceChart" style="height: 300px;"></canvas>
    </div>`,e.appendChild(t),document.getElementById("refreshButton")),t=(e&&e.addEventListener("click",fetchAndComparePrices),document.getElementById("calculateButton")),e=(t&&t.addEventListener("click",calculateCustomPrice),document.getElementById("viewMoreBtn")),t=(e&&e.addEventListener("click",()=>{currentDisplayCount+=initialDisplayCount,populateGoldPricesTable()}),document.getElementById("citySelectCustom")),e=(t&&t.addEventListener("change",e=>{var e=e.target.value,t=document.getElementById("citySelectPrices");t&&(t.value=e),updateCityPrices(e)}),document.getElementById("citySelectPrices"));e&&e.addEventListener("change",e=>{var e=e.target.value,t=document.getElementById("citySelectCustom");t&&(t.value=e),updateCityPrices(e)}),fetchAndComparePrices(),updateDateTime(),setInterval(updateDateTime,1e3),populateGoldSidebar()});
